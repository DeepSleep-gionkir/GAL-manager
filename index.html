<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê°¤ëŸ¬ë¦¬ ë§¤ë‹ˆì €: NO LIMITS (Fixed)</title>
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-panel: #1a1a1a;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --accent: #3498db;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warn: #f1c40f;
            --royal: #9b59b6;
            --border: #333;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
            margin: 0; padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        /* --- UI COMPONENTS --- */
        .screen {
            position: absolute; inset: 0;
            background: var(--bg-dark);
            z-index: 10;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            flex-direction: column;
        }
        .screen.active { display: flex; } /* active í´ë˜ìŠ¤ ë¶™ìœ¼ë©´ ë³´ì„ */

        /* Start Screen */
        #start-screen {
            justify-content: center; align-items: center;
            background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #fdbb2d);
            z-index: 999;
            text-align: center;
            padding: 20px;
        }
        .theme-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            width: 100%; max-width: 500px; margin-top: 30px;
        }
        .theme-card {
            background: rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 12px; cursor: pointer; transition: 0.2s;
            text-align: left;
        }
        .theme-card:hover, .theme-card.selected {
            background: rgba(255,255,255,0.15); border-color: var(--accent); transform: translateY(-3px);
        }
        .theme-title { font-size: 1.1rem; font-weight: 900; color: #fff; margin-bottom: 5px; display:block;}
        .theme-desc { font-size: 0.8rem; color: #ccc; }

        /* Game Header */
        header {
            background: #000; border-bottom: 1px solid var(--border);
            padding: 8px 12px;
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .badge {
            padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;
            background: #444; color: #fff; margin-right: 5px;
        }
        .badge.season { background: var(--warn); color: #000; }
        
        /* News Ticker */
        .ticker-wrap {
            width: 100%; background: #111; border-bottom: 1px solid var(--border);
            overflow: hidden; height: 24px; display: flex; align-items: center; flex-shrink: 0;
        }
        .ticker {
            display: inline-block; white-space: nowrap;
            animation: ticker 20s linear infinite;
            padding-left: 100%; color: var(--accent); font-size: 0.8rem;
        }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* Main Area */
        main { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        
        .panel { background: var(--bg-panel); border-radius: 8px; padding: 12px; border: 1px solid var(--border); }
        .panel-title { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 8px; font-weight: bold; text-transform: uppercase;}

        /* Stats Bars */
        .stat-group { display: flex; align-items: center; margin-bottom: 6px; font-size: 0.9rem; }
        .stat-icon { width: 24px; text-align: center; margin-right: 8px; }
        .progress-bg { flex: 1; height: 8px; background: #333; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; width: 50%; transition: width 0.3s ease; }
        .stat-value { width: 36px; text-align: right; font-family: monospace; font-weight: bold; margin-left: 8px; }

        /* Pasdak Grid */
        .pasdak-grid { display: grid; grid-template-columns: 1fr; gap: 5px; }
        .pasdak-row {
            background: #222; padding: 8px; border-radius: 4px; display: flex; 
            justify-content: space-between; align-items: center; border-left: 4px solid #555;
        }
        .p-msg { font-size: 0.75rem; color: #888; margin-top: 2px; font-style: italic; }
        .p-S { border-color: var(--gold); } .p-A { border-color: var(--cp); } 
        .p-B { border-color: var(--accent); } .p-F { border-color: var(--danger); background: #2c0b0b; }

        /* Logs */
        #log-container {
            flex: 1; background: #000; border: 1px solid var(--border); border-radius: 6px;
            padding: 10px; font-family: 'D2Coding', monospace; font-size: 0.85rem;
            overflow-y: auto; min-height: 120px;
        }
        .log-line { margin-bottom: 4px; padding-bottom: 4px; border-bottom: 1px solid #111; line-height: 1.4; }
        .log-time { color: #555; font-size: 0.75rem; margin-right: 5px; }
        .log-chat { color: var(--accent); }
        
        /* Footer Tabs */
        footer { background: #111; border-top: 1px solid var(--border); padding: 5px; flex-shrink: 0; }
        .tabs { display: flex; gap: 5px; margin-bottom: 5px; }
        .tab-btn {
            flex: 1; background: #222; border: none; color: #777; padding: 10px;
            font-weight: bold; cursor: pointer; border-radius: 4px; transition: 0.2s;
        }
        .tab-btn.active { background: var(--accent); color: white; }

        .action-area {
            height: 180px; overflow-y: auto; display: grid; 
            grid-template-columns: repeat(3, 1fr); gap: 6px; padding-bottom: 5px;
        }
        .act-btn {
            background: #2a2a2a; color: #eee; border: none; border-radius: 6px;
            padding: 8px; cursor: pointer; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 60px;
            position: relative; border-bottom: 3px solid #111;
        }
        .act-btn:active { transform: translateY(2px); border-bottom: 0px; }
        .act-btn:disabled { opacity: 0.3; filter: grayscale(1); cursor: not-allowed; }
        .act-name { font-size: 0.8rem; font-weight: bold; margin-bottom: 4px; }
        .act-cost { font-size: 0.7rem; color: var(--success); }
        .act-req { font-size: 0.7rem; color: var(--danger); position: absolute; bottom: 2px; }
        .btn-grow { border-bottom-color: var(--success); }
        .btn-risk { border-bottom-color: var(--danger); }

        /* End Overlay */
        #ending-screen {
            background: rgba(0,0,0,0.95); z-index: 1000;
            justify-content: center; align-items: center; text-align: center; padding: 40px;
        }
        #ending-title { font-size: 2.5rem; font-weight: 900; color: var(--danger); margin-bottom: 20px; }
        #ending-desc { font-size: 1.1rem; line-height: 1.6; color: #ccc; max-width: 600px; margin-bottom: 40px; }

        /* Utilities */
        .txt-red { color: var(--danger); }
        .txt-green { color: var(--success); }
        .txt-gold { color: var(--warn); }
        .txt-purple { color: var(--royal); }
        
        .floating { position: absolute; pointer-events: none; animation: floatUp 1s forwards; font-weight: bold; text-shadow: 1px 1px 0 #000; z-index: 999;}
        @keyframes floatUp { to { transform: translateY(-30px); opacity: 0; } }

    </style>
</head>
<body>

    <div id="start-screen" class="screen active">
        <h1 style="font-size: 2rem; color:white; text-shadow: 0 4px 10px rgba(0,0,0,0.5);">GALLERY MANAGER<br><span style="font-size:0.5em; color:var(--warn);">V8.0 FIXED</span></h1>
        <p style="color:rgba(255,255,255,0.7);">365ì¼ ìƒì¡´ | AI íŒŒë”± | ì—°êµ¬ ì‹œìŠ¤í…œ | 20ì¢… ì´ë²¤íŠ¸</p>
        
        <div class="theme-container">
            <div class="theme-card" onclick="game.init('idol')">
                <span class="theme-title">ğŸ¤ ì—°ì˜ˆ ê°¤ëŸ¬ë¦¬</span>
                <span class="theme-desc">ë†’ì€ í™”ë ¥, ê·¹ì‹¬í•œ ì¹œëª©, ë©˜íƒˆ ê³µê²© ì‹¬í•¨</span>
            </div>
            <div class="theme-card" onclick="game.init('game')">
                <span class="theme-title">ğŸ® ê²Œì„ ê°¤ëŸ¬ë¦¬</span>
                <span class="theme-desc">ë°¸ëŸ°ìŠ¤í˜•, ê°“ê²œì¶©ê³¼ ë§ë¬´ìƒˆì˜ ì „ìŸ</span>
            </div>
            <div class="theme-card" onclick="game.init('stock')">
                <span class="theme-title">ğŸ“ˆ ì£¼ì‹/ì½”ì¸ ê°¤ëŸ¬ë¦¬</span>
                <span class="theme-desc">ë†’ì€ ìê¸ˆ(CP), ë©˜íƒˆ ë¶•ê´´ ìœ„í—˜, ë„ë°•ì„±</span>
            </div>
            <div class="theme-card" onclick="game.init('pol')">
                <span class="theme-title">âš–ï¸ ì •ì¹˜/ì‚¬íšŒ ê°¤ëŸ¬ë¦¬</span>
                <span class="theme-desc">ìµœì•…ì˜ ë‚œì´ë„, ê³ ì†Œ ìœ„í—˜, ì—…ë³´ ìŠ¤íƒ</span>
            </div>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <header>
            <div style="display:flex; align-items:center;">
                <span id="season-badge" class="badge season">í‰ìˆ˜ê¸°</span>
                <span id="rank-badge" class="badge">LV.1 ë§ˆê°¤</span>
            </div>
            <div style="font-size:0.85rem; font-weight:bold;">
                <span style="color:var(--success)">âš¡ <span id="val-cp">0</span></span>
                <span style="color:#fff; margin:0 10px;">ğŸ“… <span id="val-day">1</span>/365</span>
                <span style="color:var(--royal)">ğŸ˜ˆ <span id="val-karma">0</span></span>
            </div>
        </header>

        <div class="ticker-wrap">
            <div class="ticker" id="news-ticker">ê°¤ëŸ¬ë¦¬ ë§¤ë‹ˆì € 8.0 ì‹œìŠ¤í…œ ê°€ë™... ê°¤ëŸ¬ë¦¬ê°€ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤...</div>
        </div>

        <main>
            <div class="panel">
                <div class="stat-group"><div class="stat-icon">ğŸ”¥</div><div class="progress-bg"><div id="bar-act" class="progress-fill" style="background:#e67e22;"></div></div><div id="txt-act" class="stat-value">50</div></div>
                <div class="stat-group"><div class="stat-icon">ğŸ¤¬</div><div class="progress-bg"><div id="bar-tox" class="progress-fill" style="background:#e74c3c;"></div></div><div id="txt-tox" class="stat-value">10</div></div>
                <div class="stat-group"><div class="stat-icon">ğŸ¤</div><div class="progress-bg"><div id="bar-fri" class="progress-fill" style="background:#3498db;"></div></div><div id="txt-fri" class="stat-value">0</div></div>
                <div class="stat-group"><div class="stat-icon">ğŸ§ </div><div class="progress-bg"><div id="bar-men" class="progress-fill" style="background:#9b59b6;"></div></div><div id="txt-men" class="stat-value">100</div></div>
            </div>

            <div class="panel">
                <div class="panel-title" style="display:flex; justify-content:space-between;">
                    <span>íŒŒë”±(ë¶€ë§¤ë‹ˆì €) ê´€ë¦¬ì‹¤</span>
                    <span id="pasdak-count">0/5</span>
                </div>
                <div id="pasdak-area" class="pasdak-grid">
                    <div style="color:#555; text-align:center; padding:10px; font-size:0.8rem;">ê³ ìš©ëœ íŒŒë”±ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>

            <div id="log-container">
                <div class="log-line"><span class="log-time">Day 1</span> ì‹œìŠ¤í…œì´ ì •ìƒ ê°€ë™ ì¤‘ì…ë‹ˆë‹¤.</div>
            </div>
        </main>

        <footer>
            <div class="tabs">
                <button class="tab-btn active" onclick="ui.tab('manage')">ğŸ›  ê´€ë¦¬</button>
                <button class="tab-btn" onclick="ui.tab('politics')">âš–ï¸ ì •ì¹˜</button>
                <button class="tab-btn" onclick="ui.tab('upgrade')">ğŸ§¬ ì—°êµ¬</button>
            </div>
            <div id="action-area" class="action-area"></div>
        </footer>
    </div>

    <div id="ending-screen" class="screen">
        <h1 id="ending-title">GAME OVER</h1>
        <div id="ending-desc"></div>
        <button onclick="location.reload()" style="padding:15px 40px; background:var(--success); border:none; border-radius:30px; font-size:1.2rem; font-weight:bold; cursor:pointer;">ìƒˆë¡œìš´ ì§€êµ¬ íŒŒê¸°</button>
    </div>

<script>
/**
 * ==========================================
 * DATA & CONFIG (ë°©ëŒ€í•œ ë°ì´í„°ë² ì´ìŠ¤)
 * ==========================================
 */
const DB = {
    seasons: [
        { name: "í‰ìˆ˜ê¸°", act:0, tox:0, msg: "í‰í™”ë¡œìš´ ì‹œê¸°ì…ë‹ˆë‹¤." },
        { name: "ğŸ–ï¸ ì—¬ë¦„ë°©í•™", act:5, tox:5, msg: "ê¸‰ì‹ë“¤ì´ ê°¤ëŸ¬ë¦¬ë¡œ ëª°ë ¤ì˜µë‹ˆë‹¤!" },
        { name: "ğŸ“ ì‹œí—˜ê¸°ê°„", act:-10, tox:-5, msg: "ê°¤ëŸ¬ë¦¬ê°€ ì¡°ìš©í•´ì¡ŒìŠµë‹ˆë‹¤." },
        { name: "ğŸ—³ï¸ ì„ ê±°ì² ", act:10, tox:15, msg: "ì •ì¹˜ë³‘ìë“¤ì´ ê°¤ëŸ¬ë¦¬ë¥¼ ì ë ¹í•©ë‹ˆë‹¤." },
        { name: "â›„ ê²¨ìš¸ë°©í•™", act:5, tox:5, msg: "ì¶”ì›Œì„œ ë‹¤ë“¤ ê°¤ì§ˆë§Œ í•©ë‹ˆë‹¤." },
        { name: "ğŸ§§ ëª…ì ˆ", act:20, tox:10, msg: "ì¹œì²™ ì”ì†Œë¦¬ë¥¼ í”¼í•´ ê°¤ë¡œ ë„ë§ì™”ìŠµë‹ˆë‹¤." }
    ],
    logs: {
        clean: [
            "VPN ë¶„íƒ•ì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.", "ì•¼ì§¤ í…ŒëŸ¬ë¥¼ ì§„ì••í–ˆìŠµë‹ˆë‹¤.", "ë„ë°°ê¸° IPë¥¼ ë”°ì„œ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.", 
            "ìƒˆë²½ì— ì˜¬ë¼ì˜¨ í• ì¹´ìŠ¤ë¥¼ ì§€ì› ìŠµë‹ˆë‹¤.", "ê´‘ê³  ë´‡ì„ ì°ì–´ë²„ë ¸ìŠµë‹ˆë‹¤."
        ],
        info: [
            "ì–‘ì§ˆì˜ ê³µëµê¸€ì„ ì¼ìŠµë‹ˆë‹¤.", "í•´ì™¸ ë‰´ìŠ¤ë¥¼ ë²ˆì—­í•´ì™”ìŠµë‹ˆë‹¤.", "ë‰´ë¹„ ê°€ì´ë“œë¥¼ ê°±ì‹ í–ˆìŠµë‹ˆë‹¤.",
            "ì •ì„±ìŠ¤ëŸ¬ìš´ ë¶„ì„ê¸€ì„ ì˜¬ë ¸ìŠµë‹ˆë‹¤."
        ],
        notice: [
            "ì—„ê²©í•œ ê·œì •ì„ ê³µì§€í–ˆìŠµë‹ˆë‹¤.", "ì™„ì¥ì˜ ê¶Œìœ„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.", "ë¶„íƒ•ë“¤ì—ê²Œ ê²½ê³ ì¥ì„ ë‚ ë¦½ë‹ˆë‹¤.",
            "ì¹œëª©ì§ˆ ê¸ˆì§€ ê³µì§€ë¥¼ ë„ì› ìŠµë‹ˆë‹¤."
        ],
        bait: [
            "ì¥ì‘ì„ ë„£ì–´ ê°¤ì„ ë¶ˆíƒœì›ë‹ˆë‹¤.", "vsë†€ì´ ë–¡ë°¥ì„ ë˜ì¡ŒìŠµë‹ˆë‹¤.", "ê°ˆë“±ì„ ì¡°ì¥í•´ ë¦¬ì  ì„ ì±™ê¹ë‹ˆë‹¤.",
            "ë‚¨ë…€ ê°ˆë“± ë–¡ë°¥ì„ êµ´ë ¸ìŠµë‹ˆë‹¤."
        ],
        shame: [
            "ê³ ë‹‰ í•˜ë‚˜ë¥¼ ë°•ì œí•´ì„œ ì¡°ë¦¬ëŒë¦¼í–ˆìŠµë‹ˆë‹¤.", "ë„¤ì„ë“œ ìœ ì €ë¥¼ ì €ê²©í–ˆìŠµë‹ˆë‹¤.", "ë§ˆë…€ì‚¬ëƒ¥ì„ ì£¼ë„í–ˆìŠµë‹ˆë‹¤."
        ],
        rest: [
            "ê°¤ì„ ë„ê³  ì‚°ì±…ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤.", "ì•ŒëŒì„ ë„ê³  ê¿€ì ì„ ì¤ìŠµë‹ˆë‹¤.", "í˜„ìƒì„ ì‚´ëŸ¬ ê°”ìŠµë‹ˆë‹¤.", "ë§›ìˆëŠ” ê±¸ ë¨¹ê³  ë©˜íƒˆì„ íšŒë³µí•©ë‹ˆë‹¤."
        ]
    },
    pasdakTraits: {
        S: [
            { t:"ğŸ¤– AIì•Œë°”", desc:"ë§¤í„´ ë¶„íƒ• -2, í™œì„± +1", eff:(s)=>{s.tox-=2;s.act+=1;} },
            { t:"ğŸ‘® ë³´ì•ˆê´€", desc:"ë§¤í„´ ë¶„íƒ• -3", eff:(s)=>{s.tox-=3;} },
            { t:"ğŸ‘¼ ê¸°ë¶€ì²œì‚¬", desc:"ë§¤í„´ CP +2", eff:(s)=>{s.cp+=2;} }
        ],
        A: [
            { t:"ğŸ§¹ ì²­ì†Œë¶€", desc:"ë§¤í„´ ë¶„íƒ• -1", eff:(s)=>{s.tox-=1;} },
            { t:"ğŸ¨ ì§¤ìŸì´", desc:"ë§¤í„´ í™œì„± +2", eff:(s)=>{s.act+=2;} }
        ],
        B: [
            { t:"ğŸ˜ ìœ ë™", desc:"íš¨ê³¼ ì—†ìŒ", eff:()=>{} },
            { t:"ğŸ‘€ ëˆˆíŒ…ì¡±", desc:"ë§¤í„´ í™œì„± -1", eff:(s)=>{s.act-=1;} }
        ],
        F: [
            { t:"ğŸ¤¡ ë¶„íƒ•ì¶©", desc:"ë§¤í„´ ë¶„íƒ• +3, ë©˜íƒˆ -1", eff:(s)=>{s.tox+=3;s.men-=1;} },
            { t:"ğŸ•µï¸ ì²©ì", desc:"ë§¤í„´ CP -1, ë¶„íƒ• +1", eff:(s)=>{s.cp-=1;s.tox+=1;} },
            { t:"ğŸ’¤ ì§ë¬´ìœ ê¸°", desc:"í•˜ëŠ” ì¼ì´ ì—†ìŒ", eff:()=>{} }
        ]
    },
    events: [
        { msg: "íŠ¸ëŸ­ ì‹œìœ„ê°€ ê°¤ëŸ¬ë¦¬ ì•ì—ì„œ ë²Œì–´ì§‘ë‹ˆë‹¤! (ë©˜íƒˆ ëŒ€í­ ê°ì†Œ)", cond: (s)=>s.day>50, eff: (s)=>{s.men-=20;} },
        { msg: "ë””ë„ìŠ¤ ê³µê²©ìœ¼ë¡œ ì„œë²„ê°€ í„°ì¡ŒìŠµë‹ˆë‹¤. (í™œì„±ë„ ê°ì†Œ)", cond: (s)=>s.act>80, eff: (s)=>{s.act-=30;} },
        { msg: "ìœ íŠœë²„ê°€ ê°¤ëŸ¬ë¦¬ë¥¼ ë°•ì œí–ˆìŠµë‹ˆë‹¤. (ì–´ê·¸ë¡œ í­ì¦)", cond: (s)=>s.karma>30, eff: (s)=>{s.tox+=30;} },
        { msg: "ìµëª…ì˜ ìœ ì €ê°€ ì¹˜í‚¨ì„ ë¿Œë ¸ìŠµë‹ˆë‹¤! (í™œì„±ë„ ì¦ê°€)", cond: ()=>true, eff: (s)=>{s.act+=20; s.men+=10;} },
        { msg: "ê²½ìŸ ê°¤ëŸ¬ë¦¬ì—ì„œ ì¢Œí‘œë¥¼ ì°ê³  ì¹¨ê³µí–ˆìŠµë‹ˆë‹¤!", cond: ()=>true, eff: (s)=>{s.tox+=25;} },
        { msg: "ë°©ì†¡ì— ê°¤ëŸ¬ë¦¬ê°€ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ìœ ì… ì¦ê°€)", cond: ()=>true, eff: (s)=>{s.act+=25;} }
    ]
};

const ACTIONS = {
    manage: [
        { id:'clean', n:'ê¸€ ì‚­ì œ', c:0, eff:(s)=>{s.cp+=1; s.tox-=10; s.act-=5; s.men-=2;} },
        { id:'info', n:'ì •ë³´ê¸€', c:0, eff:(s)=>{s.cp+=2; s.act+=5; s.tox-=2; s.men-=3;} },
        { id:'notice', n:'ê³µì§€ ê°±ì‹ ', c:5, eff:(s)=>{s.tox-=25; s.men-=5;} },
        { id:'ban', n:'ê´‘ì—­ ë°´', c:15, eff:(s)=>{s.tox-=50; s.act-=20; s.men-=10;} },
        { id:'contest', n:'ëŒ€íšŒ ê°œìµœ', c:40, req:2, eff:(s)=>{s.act+=40; s.fri+=15; s.men-=15;} },
        { id:'rest', n:'íœ´ì‹', c:0, eff:(s)=>{s.men+=25; s.act-=10; s.tox+=5;} }
    ],
    politics: [
        { id:'bait', n:'ì¥ì‘ ë„£ê¸°', c:0, eff:(s)=>{s.act+=20; s.tox+=15; s.cp+=3; s.men-=5;} },
        { id:'shame', n:'ê³ ë¡œì‹œ', c:5, eff:(s)=>{s.fri-=30; s.tox+=10; s.men-=10; s.karma+=5;} },
        { id:'manipulate', n:'ì—¬ë¡  ì¡°ì‘', c:10, eff:(s)=>{s.tox-=10; s.karma+=15; s.men+=5;} },
        { id:'friend', n:'ì¢†ëª© í—ˆìš©', c:0, eff:(s)=>{s.fri+=20; s.act+=5; s.cp+=5;} },
        { id:'dictator', n:'ê³„ì—„ë ¹', c:150, req:5, eff:(s)=>{s.men=100; s.tox=0; s.act-=50;} }
    ],
    upgrade: [
        { id:'gacha', n:'íŒŒë”± ê°€ì± ', c:50, desc:"ë…¸ì˜ˆ ì˜ì…", type:'once', eff:(g)=>{g.gacha();} },
        { id:'ad', n:'ì™¸ë¶€ í™ë³´', c:30, desc:"ìœ ì… ì¦ê°€", type:'once', eff:(s)=>{s.act+=30; s.tox+=10;} },
        { id:'alba', n:'ì•Œë°” ë§¤ìˆ˜', c:40, desc:"ë¶„íƒ• ì œê±°", type:'once', eff:(s)=>{s.tox-=40;} },
        { id:'clean', n:'ì´ë¯¸ì§€ ì„¸íƒ', c:50, desc:"ì—…ë³´ ê°ì†Œ", type:'once', eff:(s)=>{s.karma=Math.max(0, s.karma-30); s.tox-=10;} },
        { id:'server', n:'ì„œë²„ ì¦ì„¤', c:200, desc:"ë§¤í„´ CP+1", type:'perm', eff:(g)=>{g.perks.server=true;} },
        { id:'bot', n:'ë´‡ ë„ì…', c:300, desc:"ë§¤í„´ ë¶„íƒ•-2", type:'perm', eff:(g)=>{g.perks.bot=true;} }
    ]
};

const RANKS = [
    {n:'ë³€ë°©', r:0}, {n:'ë§ˆê°¤', r:1000}, {n:'í¥í•œê°¤', r:3000}, {n:'ë©”ì´ì €', r:10000}, {n:'ìˆ˜ë„', r:30000}, {n:'ì „ì„¤', r:100000}
];

/**
 * ==========================================
 * CORE LOGIC
 * ==========================================
 */
class Game {
    constructor() { this.reset(); }

    reset() {
        this.state = { act:40, tox:10, fri:0, men:100, cp:30, karma:0, day:1 }; // CP initialized higher for easier start
        this.pasdaks = [];
        this.perks = { server:false, bot:false };
        this.theme = null;
        this.level = 0;
        this.exp = 0;
        this.seasonIdx = 0;
        this.isOver = false;
    }

    init(theme) {
        this.theme = theme;
        const s = this.state;
        if(theme === 'idol') { s.act=70; s.fri=20; }
        if(theme === 'game') { s.act=50; s.tox=20; }
        if(theme === 'stock') { s.cp=80; s.men=60; }
        if(theme === 'pol') { s.tox=40; s.karma=10; s.act=80; }

        // **FIX**: Correctly switching screens
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('game-screen').classList.add('active');

        ui.log(`ê°¤ëŸ¬ë¦¬ê°€ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤. í…Œë§ˆ: ${theme.toUpperCase()}`);
        ui.update();
        ui.renderActions();
    }

    action(cat, idx) {
        if(this.isOver) return;
        const act = ACTIONS[cat][idx];
        if(this.state.cp < act.c) return;

        // Cost
        this.state.cp -= act.c;
        ui.float(`-${act.c} CP`, event);

        // Effect
        if(cat === 'upgrade') {
            if(act.id === 'gacha') this.gacha();
            else if(act.type === 'perm') {
                if(this.perks[act.id]) { this.state.cp+=act.c; return ui.log("ì´ë¯¸ ì—°êµ¬í–ˆìŠµë‹ˆë‹¤.", "txt-red"); }
                act.eff(this);
                ui.log(`${act.n} ì—°êµ¬ ì™„ë£Œ!`, "txt-gold");
            } else {
                act.eff(this.state);
                ui.log(`${act.n} ì™„ë£Œ.`, "txt-green");
            }
        } else {
            act.eff(this.state);
            // Log
            let msg = act.n + " í–ˆìŠµë‹ˆë‹¤.";
            if(DB.logs[act.id]) msg = DB.logs[act.id][Math.floor(Math.random()*DB.logs[act.id].length)];
            ui.log(msg, cat==='politics'?'txt-red':'txt-sub');
        }

        this.tick();
    }

    tick() {
        if(this.isOver) return;
        const s = this.state;
        s.day++;

        // 1. Season Logic
        const dy = s.day % 365;
        let si = 0;
        if(dy > 60 && dy <= 90) si=1;
        else if(dy > 90 && dy <= 100) si=2;
        else if(dy > 150 && dy <= 180) si=3;
        else if(dy > 330 || dy <= 30) si=4;
        else if(dy > 30 && dy <= 35) si=5;

        if(this.seasonIdx !== si) {
            this.seasonIdx = si;
            ui.log(`ê³„ì ˆ ë³€í™”: [${DB.seasons[si].name}] - ${DB.seasons[si].msg}`, "txt-gold");
            ui.ticker(DB.seasons[si].msg);
        }
        
        // 2. Base Decay & Growth
        let dAct = -2 + DB.seasons[si].act;
        let dTox = DB.seasons[si].tox;

        // 3. Pasdak & Perk Effects
        this.pasdaks.forEach(p => {
            p.trait.eff(s);
            // Pasdak Talk
            if(Math.random() < 0.05) {
                const talk = p.rank==='F' ? "ì™„ì¥ë‹˜ ì¼ ì¢€ í•˜ì£ ?" : "ë¶„íƒ• ë‹¤ ì¡ì•˜ìŠµë‹ˆë‹¤.";
                ui.log(`[${p.name}]: ${talk}`, "log-chat");
            }
            // Loyalty
            if(Math.random() < 0.1) p.loy -= 2;
        });
        if(this.perks.server) s.cp += 1;
        if(this.perks.bot) dTox -= 2;

        // 4. Difficulty Scaling
        if(s.act > 80) dTox += 5;
        if(s.day > 200) dTox += 5;

        s.act = Math.max(0, s.act + dAct);
        s.tox = Math.max(0, s.tox + dTox);

        // 5. Level Up
        this.exp += s.act;
        if(this.exp >= (this.level+1)*1500 && RANKS[this.level+1]) {
            this.level++;
            ui.log(`ğŸ‰ ê°¤ëŸ¬ë¦¬ ìŠ¹ê²©! [${RANKS[this.level].n}] ë‹¬ì„±!`, "txt-gold");
            s.cp += 50; s.men = 100;
            ui.renderActions();
        }

        // 6. Events
        this.checkEvents();
        this.checkEnding();
        if(!this.isOver) ui.update();
    }

    gacha() {
        if(this.pasdaks.length >= 5) return ui.log("íŒŒë”± ì •ì›ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤.", "txt-red");
        const r = Math.random() * 100;
        let rank = 'B';
        if(r < 5) rank='S'; else if(r < 20) rank='A'; else if(r > 80) rank='F';
        
        const tList = DB.pasdakTraits[rank];
        const trait = tList[Math.floor(Math.random() * tList.length)];
        const name = "ìœ ë™" + Math.floor(Math.random()*999);
        
        this.pasdaks.push({ name, rank, trait, loy: (rank==='F'?30:80) });
        ui.log(`${rank}ê¸‰ íŒŒë”± [${name}] ì˜ì…! (${trait.t})`, "txt-purple");
        ui.renderPasdaks();
    }

    fire(idx) {
        if(this.state.cp < 10) return alert("í•´ê³  ë¹„ìš©(10CP)ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        if(!confirm("ì •ë§ í•´ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        this.state.cp -= 10;
        ui.log(`${this.pasdaks[idx].name}ì„(ë¥¼) í•´ì„í–ˆìŠµë‹ˆë‹¤.`, "txt-red");
        this.pasdaks.splice(idx, 1);
        ui.renderPasdaks();
        ui.update();
    }

    checkEvents() {
        if(Math.random() > 0.3) return;
        // Find possible events
        const possible = DB.events.filter(e => e.cond(this.state));
        if(possible.length === 0) return;
        
        const ev = possible[Math.floor(Math.random() * possible.length)];
        ev.eff(this.state);
        ui.log(`[EVENT] ${ev.msg}`, "txt-warn");
        ui.ticker(`ì†ë³´: ${ev.msg}`);
    }

    checkEnding() {
        const s = this.state;
        if(s.men <= 0) this.end("ğŸš‘ ë©˜íƒˆ ë¶•ê´´", "ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•´ íì¸ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        else if(s.tox >= 100) this.end("ğŸ’£ ê°¤ëŸ¬ë¦¬ í­íŒŒ", "ì§€ë‚˜ì¹œ ë¶„íƒ•ìœ¼ë¡œ ìš´ì˜ìê°€ ê°¤ëŸ¬ë¦¬ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.");
        else if(s.fri >= 100) this.end("ğŸ¤® ì¢†ëª© ì—”ë”©", "ì¹œëª©ì§ˆë¡œ ì¸í•´ ê°¤ëŸ¬ë¦¬ê°€ ì©ì–´ ë§í–ˆìŠµë‹ˆë‹¤.");
        else if(s.karma >= 100) this.end("ğŸš” êµ¬ì† ì—”ë”©", "ì„ ì„ ë„˜ì€ ìš´ì˜ìœ¼ë¡œ ê²½ì°°ì„œ ì •ëª¨ë¥¼ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        else if(this.pasdaks.filter(p=>p.loy<10).length >= 3) this.end("ğŸ”ª íŒŒë”±ì˜ ë‚œ", "ë…¸ì˜ˆë“¤ì´ ë°˜ë€ì„ ì¼ìœ¼ì¼œ ë‹¹ì‹ ì„ ëŒì–´ë‚´ë ¸ìŠµë‹ˆë‹¤.");
        else if(s.day >= 365) this.end("ğŸ† ì „ì„¤ì˜ ì£¼ë”±", "365ì¼ê°„ì˜ ìƒì¡´. ë‹¹ì‹ ì€ ë””ì‹œì¸ì‚¬ì´ë“œì˜ ì‚´ì•„ìˆëŠ” ì „ì„¤ì…ë‹ˆë‹¤.");
    }

    end(t, d) {
        this.isOver = true;
        document.getElementById('ending-title').innerText = t;
        document.getElementById('ending-desc').innerText = d;
        document.getElementById('ending-screen').classList.add('active');
    }
}

/**
 * ==========================================
 * UI CONTROLLER
 * ==========================================
 */
const ui = {
    tabId: 'manage',
    
    update: () => {
        const s = game.state;
        document.getElementById('val-cp').innerText = s.cp;
        document.getElementById('val-day').innerText = s.day;
        document.getElementById('val-karma').innerText = s.karma;
        document.getElementById('rank-badge').innerText = RANKS[game.level] ? RANKS[game.level].n : "ì „ì„¤";
        document.getElementById('season-badge').innerText = DB.seasons[game.seasonIdx].name;

        ui.bar('act', s.act); ui.bar('tox', s.tox); ui.bar('fri', s.fri); ui.bar('men', s.men);
        ui.renderPasdaks();
        
        // Button States
        document.querySelectorAll('.act-btn').forEach(b => {
            const c = parseInt(b.dataset.cost);
            b.disabled = s.cp < c;
        });
    },

    bar: (id, val) => {
        const el = document.getElementById(`bar-${id}`);
        const txt = document.getElementById(`txt-${id}`);
        val = Math.max(0, Math.min(100, val));
        el.style.width = val + '%';
        txt.innerText = val;
    },

    renderPasdaks: () => {
        const list = document.getElementById('pasdak-area');
        document.getElementById('pasdak-count').innerText = `${game.pasdaks.length}/5`;
        list.innerHTML = '';
        if(game.pasdaks.length === 0) {
            list.innerHTML = '<div style="color:#555; text-align:center; padding:10px; font-size:0.8rem;">ê³ ìš©ëœ íŒŒë”±ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }
        game.pasdaks.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = `pasdak-row p-${p.rank}`;
            div.innerHTML = `
                <div style="flex:1">
                    <div style="font-weight:bold; font-size:0.85rem;">[${p.rank}] ${p.name} <span style="font-size:0.7rem; color:#aaa;">(${p.trait.t})</span></div>
                    <div class="p-msg">ì¶©ì„±ë„: ${p.loy}</div>
                </div>
                <button onclick="game.fire(${i})" style="background:var(--danger); border:none; color:white; padding:4px 8px; border-radius:4px; font-size:0.7rem; cursor:pointer;">í•´ê³ </button>
            `;
            list.appendChild(div);
        });
    },

    tab: (id) => {
        ui.tabId = id;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        ui.renderActions();
    },

    renderActions: () => {
        const grid = document.getElementById('action-area');
        grid.innerHTML = '';
        ACTIONS[ui.tabId].forEach((act, i) => {
            const b = document.createElement('button');
            b.className = `act-btn ${act.id==='gacha'||act.type==='perm'?'btn-grow':(ui.tabId==='politics'?'btn-risk':'')}`;
            b.dataset.cost = act.c;
            
            let html = `<span class="act-name">${act.n}</span>`;
            if(game.perks[act.id]) {
                html += `<span class="act-cost" style="color:#888">ì™„ë£Œë¨</span>`;
                b.disabled = true;
            } else {
                html += `<span class="act-cost">${act.c>0 ? act.c+' CP' : 'Free'}</span>`;
            }

            if(act.req && game.level < act.req) {
                b.disabled = true;
                html += `<span class="act-req">LV.${act.req}</span>`;
            }
            if(act.desc) html += `<span style="font-size:0.65rem; color:#888; margin-top:2px;">${act.desc}</span>`;

            b.innerHTML = html;
            b.onclick = () => game.action(ui.tabId, i);
            grid.appendChild(b);
        });
        ui.update();
    },

    log: (msg, cls='txt-sub') => {
        const c = document.getElementById('log-container');
        const div = document.createElement('div');
        div.className = `log-line ${cls}`;
        div.innerHTML = `<span class="log-time">Day ${game.state.day}</span> ${msg}`;
        c.appendChild(div);
        c.scrollTop = c.scrollHeight;
    },

    ticker: (msg) => {
        const t = document.getElementById('news-ticker');
        t.innerText = msg;
        // Animation reset hack
        t.style.animation = 'none';
        t.offsetHeight; /* trigger reflow */
        t.style.animation = 'ticker 15s linear infinite';
    },

    float: (txt, e) => {
        const el = document.createElement('div');
        el.className = 'floating';
        el.innerText = txt;
        el.style.left = e.clientX + 'px';
        el.style.top = e.clientY + 'px';
        el.style.color = '#fff';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }
};

const game = new Game();
</script>
</body>
</html>
